<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MENU TEST API</title>
    <style>
        
        .company{
            border: 1px solid fuchsia ;
          min-height: 10px;

        }
    </style>
</head>
<body>
    <h2>MENU TEST API</h2>
    <hr>
    <div id="js_result"></div>
    <button id="btn_js">GET COMPANY</button>
    <hr>
    <div id="js_error">Erreur(s):</div>
  





    <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script type="text/javascript">
    
    /* 	Auteur	: Jérémy GALLET
        Date 	: 18/03/2021
        Version	: 1.0
    */
    
    /* ====================================================== */
    /* Etape 1 : Récupération des données en Javascript natif */
    /* ====================================================== */
    
    function get_company()
    { 
        var xhr = new XMLHttpRequest();
        
        xhr.open("GET", "http://localhost/api/entreprise/lire_entreprise.php?entreprise=" , true);
        xhr.onload = function()
        {
            var html = '';
            
            if( xhr.status == 200 )
            {
                var response = JSON.parse(xhr.response);
                
                var entreprise = response.entreprise;
                var nbr_entreprises = 0;
              
             
           
                for(let i=0;i<1000;i++){
					try{
					{
                        current_company = entreprise[i];
                        html += '<div class="company-'+i+'">';
                        html += '<p>ID_Entreprise : '+current_company.ID_Entreprise+'</p>';
                        html += '<p>Nom_entreprise : '+current_company.Nom_entreprise+'</p>';
                        html += '<p>Secteur_activite : '+current_company.Secteur_activite+'</p>';
                        html += '<p>Competences_recherchees_dans_les_stages : '+current_company.Competences_recherchees_dans_les_stages+'</p>';
                        html += '<p>Nombre_de_stagiaires_CESI_deja_acceptes_en_stage : '+current_company.Nombre_de_stagiaires_CESI_deja_acceptes_en_stage+'</p>';
                        html += '<p>Evaluation_des_stagiaires : '+current_company.Evaluation_des_stagiaires+'</p>';
                        html += '<p>Confiance_du_Pilote_de_promotion : '+current_company.Confiance_du_Pilote_de_promotion+'</p>';
                        html += '<p>Localite_entreprise : '+current_company.Localite_entreprise+'</p>';
                        html += '<p>ID_Utilisateur : '+current_company.ID_Utilisateur+'</p>';
						html += '<p>image</p><img style="height: auto; width: auto; max-height: 70px" src="'+ current_company.Logo_Entreprise+'">';
                        html += '</div><hr>';
                        nbr_entreprises ++;
                       
					}
                }catch (e){
                    console.log('==>'+e+'<==');
                    if(e=="TypeError: Cannot read property 'ID_Entreprise' of undefined"){
                        document.getElementById("js_error").innerHTML = 'FIN, entreprises dispos : ' +nbr_entreprises;
                        
                    }
                    else{
                        document.getElementById("js_error").innerHTML = 'Erreur(s): '+e;

                    }
                }
                }

            }
            else
            
                html = '<p>Wrong request. Error: ' + xhr.status + '</p>';
                
            
            document.getElementById("js_result").innerHTML = html;
        };
        xhr.send();
        
    }
            
    document.getElementById("btn_js").onclick = function()
    {
        get_company();
    };

    
    
    /* ============================================ */
    /* Etape 2 : Récupération des données en jQuery */
    /* ============================================ */
    
    $("#btn_jquery" ).click(function()
    {
        $('.code').show();
        
        $.ajax({
            url: "https://reqres.in/api/users/",	//API publique de Reqres
            type: "POST",
            data: {name: "Paul Ochon", job: "Commercial chez Epeda", place: "Toulon"}, //Données fictives à envoyer dans la requête POST
            
            success: function(response, textStatus, xhr)
            {
                var html = ''; 
                
                if( xhr.status == 201 )
                {
                    html = xhr.responseText + '<br />';
                    data = xhr.responseJSON;
                    $.each(data, function(key, value)
                    {
                        html += key + ': ' + value + '<br />';
                    });
                }
                else
                    html = 'Error! Status: ' + xhr.status;

                $('#jquery_result').html(html);
            },
            error: function (xhr, ajaxOptions, thrownError)
            {
                $('#jquery_result').html('Error: ' + xhr.status);
                console.log(thrownError);
            }
        });
            
    });
    </script>



</body>
</html>